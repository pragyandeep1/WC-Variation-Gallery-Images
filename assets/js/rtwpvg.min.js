!function(i){"use strict";i.fn.rtWpVGallery=function(){return this._item=i(this),this._target=this._item.parent(),this._product=this._item.closest(".product"),this._default_gallery_images=this.data("default-images")||[],this._variation_form=this._product.find(".variations_form"),this._product_id=this._variation_form.data("product_id"),this._is_variation_product=!!this._variation_form.length,this._is_bundle_product=this._item.hasClass("rtwpvg-product-type-bundle"),this._slider=i(".rtwpvg-slider",this._item),this._thumbnail=i(".rtwpvg-thumbnail-slider",this._item),this.initial_load=!0,this.thumbSliderOptionsValue=this._thumbnail.data("options")?this._thumbnail.data("options"):{},this.mainSliderOptionsValue=this._slider.data("options")?this._slider.data("options"):{},this.sliderThumbnailPosition=this._item.data("thumbnail_position"),this.isSlide_vertical="left"===this.sliderThumbnailPosition||"right"===this.sliderThumbnailPosition,this.is_vertical=!!this.thumbSliderOptionsValue.vertical,this._grid=i(".rtwpvg-grid-layout",this._item),this.is_grid_layout="grid"===this.sliderThumbnailPosition,this.slider_enabled="function"==typeof Swiper,this.defaultOptions={observer:!0,speed:400},this.removeLoading=function(){this._item.removeClass("loading-rtwpvg")},this.addLoading=function(){this._item.addClass("loading-rtwpvg")},this.loadDefaultGalleryImages=function(){var i=this;if(this._is_variation_product&&!this._default_gallery_images.length){var t=this;wp.ajax.send("rtwpvg_get_default_gallery_images",{data:{product_id:this._product_id},success:function(i){t._default_gallery_images=i,t._item.trigger("rtwpvg_default_gallery_image_loaded")},error:function(i){t._default_gallery_images=[],t._item.trigger("rtwpvg_default_gallery_image_loaded")}})}setTimeout((function(){i.loadZoom(i._slider.find(".swiper-wrapper"))}),150)},this.initSlider=function(){var t=this;if(this.slider_enabled){if(this.setThumbnailMaxHeight(),this.swiperThumbnailSlider=null,rtwpvg.enable_thumbnail_slide){var e=Object.assign({},this.defaultOptions,this.thumbSliderOptionsValue||{});this.$mainThumbnail=this._thumbnail,this.$thumbnail=this.$mainThumbnail.get(0),this.$thumbnail&&(this.swiperThumbnailSlider=this.$thumbnail.swiper||null),this.swiperThumbnailSlider?this.swiperThumbnailSlider.update():this.swiperThumbnailSlider=new Swiper(this.$thumbnail,e)}this.$mainSlider=this._slider,this.$slider=this.$mainSlider.get(0),this.swiperSlider=null;var a=Object.assign({},this.defaultOptions,this.mainSliderOptionsValue||{});this.$slider&&(this.swiperSlider=this.$slider.swiper||null),this.swiperSlider?this.swiperSlider.update():(this.swiperThumbnailSlider?a.thumbs={swiper:this.swiperThumbnailSlider}:delete a.thumbs,this.swiperSlider=new Swiper(this.$slider,a)),rtwpvg.enable_thumbnail_slide||(this._thumbnail.addClass("loaded-thumbnail-no-slider"),this._thumbnail.not(".swiper-initialized").find(".rtwpvg-thumbnail-image").each((function(e,r){i(r).find("div, img").on("click",(function(i){i.preventDefault(),i.stopPropagation(),t.swiperSlider.slideTo(e,a.speed)}))})))}},this.loadSlider=function(){var i=this;this.initSlider(),setTimeout((function(){i._item.trigger("rtwpvg_slider_init")}),1)},this.stopVideo=function(t){i(t).find("iframe, video").each((function(){var t=i(this).prop("tagName").toLowerCase();if("iframe"===t){var e=i(this).attr("src");i(this).attr("src",e)}"video"===t&&i(this)[0].pause()}))},this.setThumbnailMaxHeight=function(){if(this._slider.length>0&&this.isSlide_vertical){var t=0;this._slider.find(".rtwpvg-gallery-image").find(".rtwpvg-single-image-container img").each((function(){var e=i(this).height();e>t&&(t=e)})),this._thumbnail.height(parseInt(t))}},this.loadZoom=function(t){if(rtwpvg.enable_zoom){var e,a,r=!1;if(a=this.is_grid_layout?this._grid.find(".rtwpvg-gallery-image"):t.find(".rtwpvg-gallery-image"),i(a).each((function(t,a){e=i(this).width();var s=i(this).find(".rtwpvg-single-image-container img");if(parseInt(s.data("large_image_width"))>e)return r=!0,!1})),i.fn.zoom&&r){var s=i.extend({touch:!1},wc_single_product_params.zoom_options);"ontouchstart"in document.documentElement&&(s.on="click"),a.trigger("zoom.destroy"),a.zoom(s)}}},this.loadPhotoSwipe=function(){var i=this;rtwpvg.enable_lightbox&&(this._item.off("click",".rtwpvg-trigger"),this._item.on("click",".rtwpvg-trigger",(function(t){i.openPhotoSwipe(t)})),rtwpvg.lightbox_image_click&&(this._item.off("click",".rtwpvg-gallery-image"),this.is_grid_layout&&this._item.off("click",".rtwpvg-trigger"),this._item.on("click",".rtwpvg-gallery-image",(function(t){i.openPhotoSwipe(t)}))))},this.openPhotoSwipe=function(t){var e;if(t.preventDefault(),"undefined"==typeof PhotoSwipe)return!1;var a=this,r=i(".pswp")[0],s=this.getGalleryItems(),n=i.extend({index:null===(e=this._slider.get(0))||void 0===e?void 0:e.swiper.activeIndex},wc_single_product_params.photoswipe_options);if(a.is_grid_layout){var o=i(t.target).parents(".rtwpvg-gallery-image").find(".rtwpvg-single-image-container img").data("src"),l=s.findIndex((function(i){return i.src===o}));n.index=l}var d=new PhotoSwipe(r,PhotoSwipeUI_Default,s,n);d.listen("close",(function(){a.stopVideo(r)})),d.listen("afterChange",(function(){a.stopVideo(r)})),d.init()},this.getGalleryItems=function(){var t=[],e=this._item.find(".rtwpvg-gallery-image");return e.length>0&&e.each((function(e,a){var r=i(a).find("img, iframe, video"),s=void 0;switch(i(r).prop("tagName").toLowerCase()){case"img":s={src:r.attr("data-large_image"),w:r.attr("data-large_image_width"),h:r.attr("data-large_image_height"),title:r.attr("data-caption")?r.attr("data-caption"):r.attr("title")};break;case"iframe":s={html:'<iframe class="rtwpvg-lightbox-iframe" src="'+r.attr("src")+'" style="width: 100%; height: 100%; margin: 0;padding: 0; background-color: #000000" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'};break;case"video":s={html:'<video class="rtwpvg-lightbox-video" controls controlsList="nodownload" src="'+r.attr("src")+'" style="width: 100%; height: 100%; margin: 0;padding: 0; background-color: #000000"></video>'}}t.push(s)})),t},this.loadGallery=function(i){var t=this,e=i.length>1;this._item.trigger("before_rtwpvg_load",[i]);var a="";if(this._slider.length){var r=i.map((function(i){return wp.template("rtwpvg-slider-template")(i)})).join("");a=i.map((function(i){return wp.template("rtwpvg-thumbnail-template")(i)})).join(""),this._slider.find(".swiper-wrapper").html(r),e?(this._target.addClass("rtwpvg-has-product-thumbnail"),this._thumbnail.find(".swiper-wrapper").html(a),this._thumbnail.parents(".rtwpvg-images").removeClass("rtwpvg-no-gallery-images"),this._thumbnail.parents(".rtwpvg-images").addClass("rtwpvg-has-gallery-images")):(this._target.removeClass("rtwpvg-has-product-thumbnail"),this._thumbnail.find(".swiper-wrapper").html(""),this._thumbnail.parents(".rtwpvg-images").removeClass("rtwpvg-has-gallery-images"),this._thumbnail.parents(".rtwpvg-images").addClass("rtwpvg-no-gallery-images")),setTimeout((function(){t.loadZoom(t._slider.find(".swiper-wrapper"))}),100)}if(this.is_grid_layout){var s=i.map((function(i){return wp.template("rtwpvg-template-grid-layout")(i)})).join("");this._grid.html(s),setTimeout((function(){t.loadZoom(s)}),1)}setTimeout((function(){t.imagesLoaded(),t.hasVideo()}),1),setTimeout((function(){t.removeLoading()}),1)},this.resetGallery=function(){var i=this;this._default_gallery_images.length>0&&this.loadGallery(this._default_gallery_images),setTimeout((function(){i.removeLoading()}),1)},this.imagesLoaded=function(){var t=this;if(i.fn.imagesLoaded.done)return this._item.trigger("rtwpvg_image_loading",[t]),void this._item.trigger("rtwpvg_image_loaded",[t]);this._item.imagesLoaded().progress((function(i,e){t._item.trigger("rtwpvg_image_loading",[t])})).done((function(i){t._item.trigger("rtwpvg_image_loaded",[t])}))},this.loadVariationGallery=function(){var i=this;this._variation_form.off("reset_image.rtwpvg"),this._variation_form.off("click.rtwpvg"),this._variation_form.off("show_variation.rtwpvg"),rtwpvg.reset_on_variation_change?this._variation_form.on("reset_image.rtwpvg",(function(t){i.addLoading(),i.resetGallery()})):this._variation_form.on("click.rtwpvg",".show_variation",(function(t){i.addLoading(),i.resetGallery()})),this._variation_form.on("show_variation.rtwpvg",(function(t,e){i.addLoading(),i.loadGallery(e.variation_gallery_images)}))},this.hasVideo=function(){this._item.find(".rtwpvg-thumbnail-video").length?this._item.addClass("rtwpvg-video-full-height"):this._item.removeClass("rtwpvg-video-full-height")},this.loadEvents=function(){this._item.on("rtwpvg_image_loaded",this.init.bind(this))},this.init=function(i){var t=this;setTimeout((function(){t._slider.length&&t.loadSlider(),t.is_grid_layout&&t.loadZoom(t.is_grid_layout),t.loadPhotoSwipe(),t.removeLoading()}),10)},this.start=function(){this._is_bundle_product&&(this._product_id=this._variation_form.data("bundle_id")),this.loadDefaultGalleryImages(),this.loadEvents(),this.is_variation_product&&!this._is_bundle_product||this.imagesLoaded(),this._is_bundle_product||this.loadVariationGallery(),this.init(),this._variation_form.trigger("reload_product_variations"),i(document).trigger("rtwpvg_loaded")},this.start(),this},i(window).on("load",(function(){i(".rtwpvg-wrapper:not(.rtwpvg-product-type-variable)").rtWpVGallery()})),i(document).on("wc_variation_form",".variations_form",(function(){i(".rtwpvg-wrapper, .rtwpvg-grid-wrapper").rtWpVGallery()})),i(document.body).on("post-load",(function(){i(".rtwpvg-wrapper").rtWpVGallery()})),i(document.body).on("jckqv_open",(function(){i(".rtwpvg-wrapper").rtWpVGallery()})),i(document.body).on("quick-view-displayed",(function(){i(".rtwpvg-wrapper").rtWpVGallery()})),i(document).on("qv_loader_stop",(function(){i(".rtwpvg-wrapper:not(.rtwpvg-product-type-variable)").rtWpVGallery()})),i(document).on("rtsbQv.success",(function(){i(".rtwpvg-wrapper").rtWpVGallery()}))}(jQuery);
