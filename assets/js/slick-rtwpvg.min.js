!function(i){"use strict";i.fn.rtWpVGallery=function(){return this._item=i(this),this._target=this._item.parent(),this._product=this._item.closest(".product"),this._default_gallery_images=this.data("default-images")||[],this._variation_form=this._product.find(".variations_form"),this._product_id=this._variation_form.data("product_id"),this._is_variation_product=!!this._variation_form.length,this._is_bundle_product=this._item.hasClass("rtwpvg-product-type-bundle"),this._slider=i(".rtwpvg-slider",this._item),this._thumbnail=i(".rtwpvg-thumbnail-slider",this._item),this.initial_load=!0,this.slickValue=this._thumbnail.data("slick")?this._thumbnail.data("slick"):{},this.slickThumbnailPosition=this._item.data("thumbnail_position"),this.isSlick_vertical="left"===this.slickThumbnailPosition||"right"===this.slickThumbnailPosition,this.is_vertical=!!this.slickValue.vertical,this._grid=i(".rtwpvg-grid-layout",this._item),this.is_grid_layout="grid"===this.slickThumbnailPosition,this.removeLoading=function(){this._item.removeClass("loading-rtwpvg")},this.addLoading=function(){this._item.addClass("loading-rtwpvg")},this.loadDefaultGalleryImages=function(){if(this._is_variation_product&&!this._default_gallery_images.length){var i=this;wp.ajax.send("rtwpvg_get_default_gallery_images",{data:{product_id:this._product_id},success:function(t){i._default_gallery_images=t,i._item.trigger("rtwpvg_default_gallery_image_loaded")},error:function(t){i._default_gallery_images=[],i._item.trigger("rtwpvg_default_gallery_image_loaded")}})}},this.loadSlider=function(){var t=this;try{this._slider.hasClass("slick-initialized")&&this._slider.slick("unslick")}catch(i){}this._slider.off("init"),this._slider.off("beforeChange"),this._slider.off("afterChange"),this._item.trigger("rtwpvg_before_init"),this._slider.on("init",(function(i){t.initial_load&&(t.initial_load=!1)})).on("beforeChange",(function(i,e,s,a){t._thumbnail.find(".rtwpvg-thumbnail-image").not(".slick-slide").removeClass("current-thumbnail").eq(a).addClass("current-thumbnail")})).on("afterChange",(function(i,e,s){t.stopVideo(t._slider),t.loadZoom(s)})).slick(),this._thumbnail.find(".rtwpvg-thumbnail-image").not(".slick-slide").first().addClass("current-thumbnail"),this._thumbnail.find(".rtwpvg-thumbnail-image").not(".slick-slide").each((function(e,s){i(s).find("div, img").on("click",(function(i){i.preventDefault(),i.stopPropagation(),t._slider.slick("slickGoTo",e)}))})),this.isSlick_vertical&&rtwpvg.enable_thumbnail_slide&&(i(window).on("resize",t.setThumbnailPositionOnResize()),this._slider.on("setPosition",t.setThumbnailHeightOnSetPosition()),this._slider.on("afterChange",(function(){t.setThumbnailHeight()})));var e=this._thumbnail.find(".rtwpvg-thumbnail-image");parseInt(rtwpvg.thumbnails_columns)<e.length&&rtwpvg.enable_thumbnail_slide?(e.removeClass("current-thumbnail"),this.loadThumbnailSlider()):this._slider.slick("slickSetOption","asNavFor",null,!1),setTimeout((function(){t._item.trigger("rtwpvg_slider_init")}),1),setTimeout((function(){t.removeLoading()}),1)},this.stopVideo=function(t){i(t).find("iframe, video").each((function(){var t=i(this).prop("tagName").toLowerCase();if("iframe"===t){var e=i(this).attr("src");i(this).attr("src",e)}"video"===t&&i(this)[0].pause()}))},this.setThumbnailHeight=function(){this.is_vertical?this._slider.slick("getSlick").$slides.length>1?this._thumbnail.height(this._slider.height()):this._thumbnail.height(0):this._thumbnail.height("auto"),this._thumbnail.hasClass("slick-initialized")&&this._thumbnail.slick("setPosition")},this.setThumbnailHeightOnSetPosition=function(){var i=this;return this.setThumbnailHeight(),_.debounce((function(){i.setThumbnailHeight()}),401)},this.setThumbnailPositionOnResize=function(){var i=this;return i.setThumbnailPosition(),_.debounce((function(){i.setThumbnailPosition()}),400)},this.setThumbnailPosition=function(){this.isSlick_vertical&&window.matchMedia("(max-width: 479px)").matches?(this.is_vertical=!1,this.slickValue.vertical=!1,this._item.removeClass("rtwpvg-thumbnail-position-left rtwpvg-thumbnail-position-right rtwpvg-thumbnail-position-bottom"),this._item.addClass("rtwpvg-thumbnail-position-bottom"),this._slider.slick("setPosition")):this.isSlick_vertical&&!this.is_vertical&&(this.is_vertical=!0,this.slickValue.vertical=!0,this._item.removeClass("rtwpvg-thumbnail-position-left rtwpvg-thumbnail-position-right rtwpvg-thumbnail-position-bottom"),this._item.addClass("rtwpvg-thumbnail-position-"+this.slickThumbnailPosition),this._slider.slick("setPosition"))},this.loadThumbnailSlider=function(){var i=this;try{this._thumbnail.hasClass("slick-initialized")&&this._thumbnail.slick("unslick")}catch(i){}this._thumbnail.off("init"),this._thumbnail.on("init",(function(){})).slick(),setTimeout((function(){i._item.trigger("rtwpvg_thumbnail_slider_init")}),1)},this.callZoom=function(){var i=this._slider.slick("slickCurrentSlide");this.loadZoom(i)},this.loadZoom=function(t){if(rtwpvg.enable_zoom){var e,s=parseInt(this._target.width()),a=!1;if(e=this.is_grid_layout?this._grid.find(".rtwpvg-gallery-image"):this._slider.slick("getSlick").$slides.eq(t),i(e).each((function(t,e){var r=i(e).find("img");if(parseInt(r.data("large_image_width"))>s)return a=!0,!1})),i.fn.zoom&&a){var r=i.extend({touch:!1},wc_single_product_params.zoom_options);"ontouchstart"in document.documentElement&&(r.on="click"),e.trigger("zoom.destroy"),e.zoom(r)}}},this.loadPhotoSwipe=function(){var i=this;rtwpvg.enable_lightbox&&(this._item.off("click",".rtwpvg-trigger"),this._item.on("click",".rtwpvg-trigger",(function(t){i.openPhotoSwipe(t)})),rtwpvg.lightbox_image_click&&(this._item.off("click",".rtwpvg-gallery-image"),this.is_grid_layout&&this._item.off("click",".rtwpvg-trigger"),this._item.on("click",".rtwpvg-gallery-image",(function(t){i.openPhotoSwipe(t)}))))},this.openPhotoSwipe=function(t){if(t.preventDefault(),"undefined"==typeof PhotoSwipe)return!1;var e=this,s=i(".pswp")[0],a=this.getGalleryItems(),r=i.extend({index:this._slider.slick("slickCurrentSlide")},wc_single_product_params.photoswipe_options);if(e.is_grid_layout){var o=i(t.target).parents(".rtwpvg-gallery-image").find(".rtwpvg-single-image-container img").data("src"),n=a.findIndex((function(i){return i.src===o}));r.index=n}var l=new PhotoSwipe(s,PhotoSwipeUI_Default,a,r);l.listen("close",(function(){e.stopVideo(s)})),l.listen("afterChange",(function(){e.stopVideo(s)})),l.init()},this.getGalleryItems=function(){var t=[],e=this._item.find(".rtwpvg-gallery-image");return this._slider.length&&(e=this._slider.slick("getSlick").$slides),e.length>0&&e.each((function(e,s){var a=i(s).find("img, iframe, video"),r=void 0;switch(i(a).prop("tagName").toLowerCase()){case"img":r={src:a.attr("data-large_image"),w:a.attr("data-large_image_width"),h:a.attr("data-large_image_height"),title:a.attr("data-caption")?a.attr("data-caption"):a.attr("title")};break;case"iframe":r={html:'<iframe class="rtwpvg-lightbox-iframe" src="'+a.attr("src")+'" style="width: 100%; height: 100%; margin: 0;padding: 0; background-color: #000000" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'};break;case"video":r={html:'<video class="rtwpvg-lightbox-video" controls controlsList="nodownload" src="'+a.attr("src")+'" style="width: 100%; height: 100%; margin: 0;padding: 0; background-color: #000000"></video>'}}t.push(r)})),t},this.destroySlider=function(){this._slider.html(""),this._thumbnail.html("");try{this._slider.hasClass("slick-initialized")&&this._slider.slick("unslick"),this._thumbnail.hasClass("slick-initialized")&&this._thumbnail.slick("unslick")}catch(i){}this._item.trigger("rtwpvg_slider_destroy")},this.loadGallery=function(i){var t=this,e=i.length>1;this._item.trigger("before_rtwpvg_load",[i]),this.destroySlider();var s="";if(this._slider.length){var a=i.map((function(i){return wp.template("rtwpvg-slider-template")(i)})).join("");s=i.map((function(i){return wp.template("rtwpvg-thumbnail-template")(i)})).join(""),this._slider.html(a),e?(this._target.addClass("rtwpvg-has-product-thumbnail"),this._thumbnail.html(s)):(this._target.removeClass("rtwpvg-has-product-thumbnail"),this._thumbnail.html(""))}if(this.is_grid_layout){var r=i.map((function(i){return wp.template("rtwpvg-template-grid-layout")(i)})).join("");this._grid.html(r),setTimeout((function(){t.loadZoom(r)}),1)}setTimeout((function(){t.imagesLoaded(),t.hasVideo()}),1)},this.resetGallery=function(){var i=this;this._default_gallery_images.length>0?this.loadGallery(this._default_gallery_images):setTimeout((function(){i.removeLoading()}),1)},this.imagesLoaded=function(){var t=this;if(i.fn.imagesLoaded.done)return this._item.trigger("rtwpvg_image_loading",[t]),void this._item.trigger("rtwpvg_image_loaded",[t]);this._item.imagesLoaded().progress((function(i,e){t._item.trigger("rtwpvg_image_loading",[t])})).done((function(i){t._item.trigger("rtwpvg_image_loaded",[t])}))},this.loadVariationGallery=function(){var i=this;this._variation_form.off("reset_image.rtwpvg"),this._variation_form.off("click.rtwpvg"),this._variation_form.off("show_variation.rtwpvg"),rtwpvg.reset_on_variation_change?this._variation_form.on("reset_image.rtwpvg",(function(t){i.addLoading(),i.resetGallery()})):this._variation_form.on("click.rtwpvg",".show_variation",(function(t){i.addLoading(),i.resetGallery()})),this._variation_form.on("show_variation.rtwpvg",(function(t,e){i.addLoading(),i.loadGallery(e.variation_gallery_images)}))},this.hasVideo=function(){var i=this._item.find(".rtwpvg-thumbnail-video");console.log("Has Video",i.length),i.length?this._item.addClass("rtwpvg-video-full-height"):this._item.removeClass("rtwpvg-video-full-height")},this.loadEvents=function(){this._item.on("rtwpvg_image_loaded",this.init.bind(this))},this.init=function(i){var t=this;setTimeout((function(){t._slider.length&&t.loadSlider(),(t._slider.length||t.is_grid_layout)&&t.callZoom(),t.loadPhotoSwipe()}),1)},this.start=function(){this._is_bundle_product&&(this._product_id=this._variation_form.data("bundle_id")),this.loadDefaultGalleryImages(),this.loadEvents(),this.is_variation_product&&(this._slider.length&&(this.loadSlider(),this.callZoom()),this.loadPhotoSwipe()),this.is_variation_product&&!this._is_bundle_product||this.imagesLoaded(),this._is_bundle_product||this.loadVariationGallery(),this._variation_form.trigger("reload_product_variations"),i(document).trigger("rtwpvg_loaded")},this.start(),this},i(window).on("load",(function(){i(".rtwpvg-wrapper:not(.rtwpvg-product-type-variable)").rtWpVGallery()})),i(document).on("wc_variation_form",".variations_form",(function(){i(".rtwpvg-wrapper, .rtwpvg-grid-wrapper").rtWpVGallery()})),i(document.body).on("post-load",(function(){i(".rtwpvg-wrapper").rtWpVGallery()})),i(document.body).on("jckqv_open",(function(){i(".rtwpvg-wrapper").rtWpVGallery()})),i(document.body).on("quick-view-displayed",(function(){i(".rtwpvg-wrapper").rtWpVGallery()})),i(document).on("qv_loader_stop",(function(){i(".rtwpvg-wrapper:not(.rtwpvg-product-type-variable)").rtWpVGallery()})),i(document).on("rtsbQv.success",(function(){i(".rtwpvg-wrapper").rtWpVGallery()}))}(jQuery);
