!function(e){"use strict";function t(){e(document).off("click",".rtwpvg-add-image"),e(document).on("click",".rtwpvg-add-image",i),e(document).on("click",".rtwpvg-remove-image",n),e(document).on("click",".rtwpvg-media-video-popup",a),e(".woocommerce_variation").each((function(){var t=e(this).find(".options");e(this).find(".rtwpvg-gallery-wrapper").insertBefore(t)}))}function i(t){t.preventDefault(),t.stopPropagation();var i=this,a=0,n=e(this).data("product_variation_id"),p=e(this).data("product_variation_loop"),s=e(this).parents(".rtwpvg-gallery-wrapper").find("input").map((function(){return Number(e(this).val())})).get();if(console.log(s),"undefined"!=typeof wp&&wp.media&&wp.media.editor){if(a)return void a.open();(a=wp.media.frames.select_image=wp.media({title:rtwpvg_admin.choose_image,button:{text:rtwpvg_admin.add_image},library:{type:["image"]},multiple:!0})).on("select",(function(){var t=a.state().get("selection").toJSON().map((function(e){if("image"===e.type){if(console.log(e),-1===s.indexOf(e.id)){var t=e.id,i=e.rtwpvg_video_link,a=e.sizes,r=(a=void 0===a?{}:a).thumbnail,o=a.full,c=r?r.url:o.url;return wp.template("rtwpvg-image")({id:t,url:c,product_variation_id:n,loop:p,rtwpvg_video_link:i})}alert("Cannot add duplicate items.")}})).join("");e(i).parent().prev().find(".rtwpvg-images").append(t),o(),r(i)})),a.open()}}function a(t){t.preventDefault(),t.stopPropagation();var i=this,a=0;if("undefined"!=typeof wp&&wp.media&&wp.media.editor){if(a)return void a.open();(a=wp.media.frames.select_image=wp.media({title:rtwpvg_admin.choose_video,button:{text:rtwpvg_admin.add_video},library:{type:["video"]},multiple:!1})).on("select",(function(){var t=a.state().get("selection").first().toJSON();"video"===t.type&&e(i).closest(".compat-attachment-fields").find(".compat-field-rtwpvg_video_link input").val(t.url).change()})),a.open()}}function n(t){t.preventDefault(),t.stopPropagation();var i=this;r(this),setTimeout((function(){e(i).parent().remove()}),1)}function r(t){e(t).closest(".woocommerce_variation").addClass("variation-needs-update"),e("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),e("#variable_product_options").trigger("woocommerce_variations_input_changed")}function o(){e(".rtwpvg-images").sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"rtwpvg-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){r(this)}})}function p(){"grid"==e("#thumbnail_position-field").val()?(e("#thumbnail_slide-wrapper").hide(),e("#slider_arrow-wrapper").hide(),e("#slider_adaptive_height-wrapper").hide()):(e("#thumbnail_slide-wrapper").show(),e("#slider_arrow-wrapper").show(),e("#slider_adaptive_height-wrapper").show())}e.fn.wpColorPicker&&e("input.rtwpvg-color-picker").wpColorPicker(),e("#rtwpvg-settings-wrapper").on("click",".nav-tab",(function(t){t.preventDefault();var i=e(this),a=i.data("target");if(i.addClass("nav-tab-active").siblings().removeClass("nav-tab-active"),e("#"+a).show().siblings().hide(),e("#_last_active_tab").val(a),history.pushState){var n=function(e,t){var i=window.location.href,a=location.hash;if((i=i.replace(a,"")).indexOf("?")>=0){var n=i.substring(i.indexOf("?")+1).split("&"),r=!1;n.forEach((function(i,a){i.split("=")[0]==e&&(n[a]=e+"="+t,r=!0)})),r||n.push(e+"="+t),i=i.substring(0,i.indexOf("?")+1)+n.join("&")}else i+="?"+e+"="+t;return i+a}("section",a);window.history.pushState({path:n},"",n)}})),e(".rtwpvg-setting-tab #license_key-wrapper").on("keyup","#license_key-field",(function(t){t.preventDefault(),e(".license-status").html("When add license key first click on Save changes")})),e(".rtwpvg-setting-tab #license_key-wrapper").on("click",".rt-licensing-btn",(function(t){t.preventDefault(),console.log("clicked");var i=e(this),a=i.hasClass("license_activate")?"license_activate":"license_deactivate";e.ajax({type:"POST",url:rtwpvg_admin.ajaxurl,data:{action:"rtwpvg_manage_licensing",type:a},beforeSend:function(){i.addClass("loading"),i.parents(".description").find(".rt-licence-msg").remove(),e('<span class="rt-icon-spinner animate-spin"></span>').insertAfter(i)},success:function(t){i.next(".rt-icon-spinner").remove(),i.removeClass("loading"),t.error||(i.text(t.value),i.removeClass(a),i.addClass(t.type),"license_deactivate"==t.type?(i.removeClass("button-primary"),i.addClass("danger")):"license_activate"==t.type&&(i.removeClass("danger"),i.addClass("button-primary"))),t.msg&&e("<span class='rt-licence-msg'>"+t.msg+"</span>").insertAfter(i),i.blur()},error:function(e,t){i.removeClass("loading"),i.next(".rt-icon-spinner").remove()}})})),e("#woocommerce-product-data").on("woocommerce_variations_loaded",(function(){t(),o()})),e("#variable_product_options").on("woocommerce_variations_added",(function(){t(),o()})),e("#woocommerce-product-images .add_product_images").on("click","a",(function(t){e(document).on("click",".rtwpvg-media-video-popup",a)})),e((function(){function t(){e("#preloader-field").is(":checked")?(e("#preloader_image-wrapper").show(),e("#preload_style-wrapper").show()):(e("#preloader_image-wrapper").hide(),e("#preload_style-wrapper").hide())}e("#rtwpvg-settings-wrapper").on("click",".pro-field",(function(t){t.preventDefault(),e(".rtvg-pro-alert").show()})),e(".rtvg-pro-alert-close").on("click",(function(t){t.preventDefault(),e(".rtvg-pro-alert").hide()})),t(),e(document).on("change","#preloader-field",(function(){t()})),e(document).on("click",".rtwpvg-upload-box",(function(t){t.preventDefault();var i,a,n=e(this).attr("data-name"),r=e(this).attr("data-field"),o=e(this);void 0===i?((i=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",multiple:"image"!=r})).on("insert",(function(){if(a=i.state().get("selection").first().toJSON(),!(0>e.trim(a.url.length))){var t=i.state().get("selection").toJSON(),p="",s="image"==r?"":"[]";t.forEach((function(e){p+="<div class='rtwpvg-preview-img'><img src='"+e.url+"' /><input type='hidden' name='"+n+s+"' value='"+e.id+"'><button class='rtwpvg-file-remove' data-id='"+e.id+"'>x</button></div>"})),o.prev().html(p)}})),i.open()):i.open()})),e(document).on("click",".rtwpvg-file-remove",(function(t){t.preventDefault(),confirm(rtwpvg_admin.sure_txt)&&(e(this).parent().parent().children(".rtwpvg-preview-img").length<=1?(e(this).parent().children("img").remove(),e(this).parent().children("input").val(0),e(this).remove()):e(this).parent().remove())})),p(),e("#thumbnail_position-field").on("change",(function(e){e.preventDefault(),p()}))}))}(jQuery);
